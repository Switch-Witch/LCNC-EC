# optidrive_mb2hal.ini
# MB2HAL-Konfiguration für Optidrive E3 über /dev/ttyACM1

[MB2HAL_INIT]
# Debug-Level für Initialisierung/Parsing
# 0 = ruhig, 1 = Fehler, 2 = OK-Meldungen, 3 = ausführlich
INIT_DEBUG=1

# Name des HAL-Moduls (Standard = mb2hal)
HAL_MODULE_NAME=mb2hal

# Keine künstliche Verzögerung zwischen Transaktionen
SLOWDOWN=0.0

# Wir definieren 3 Transaktionen:
# 00: Schreibe Steuerwort (Register 1)
# 01: Schreibe Frequenz-Sollwert (Register 2)
# 02: Lese Istfrequenz + Motorstrom (Register 7 + 8)
TOTAL_TRANSACTIONS=3


# ==================== TRANSACTION 00 ====================
# Schreibe Steuerwort (Register 1)

[TRANSACTION_00]

# Serielle Verbindung
LINK_TYPE=serial
SERIAL_PORT=/dev/ttyACM1

# Baudrate MUSS zu P-36.2 im VFD passen!
# Beispiel: 9600 oder 115200
SERIAL_BAUD=115200
SERIAL_BITS=8
SERIAL_PARITY=none
SERIAL_STOP=1
SERIAL_DELAY_MS=10

# Modbus Slave ID (P-36.1)
MB_SLAVE_ID=1

# Erstes Register (1 = Steuerwort)
FIRST_ELEMENT=1
# Anzahl Register
NELEMENTS=1

# Schreiben mehrerer Holding-Register (funktioniert auch mit NELEMENTS=1)
MB_TX_CODE=fnct_16_write_multiple_registers

# Name der Transaktion -> HAL-Pins: mb2hal.optidrive_cmd.00
HAL_TX_NAME=optidrive_cmd

# max. Update-Rate (Hz) – 10 Hz reicht für Start/Stop völlig
MAX_UPDATE_RATE=10.0
DEBUG=0


# ==================== TRANSACTION 01 ====================
# Schreibe Frequenz-Sollwert (Register 2)

[TRANSACTION_01]

# Gleiche serielle Verbindung wie oben wird wiederverwendet

MB_SLAVE_ID=1
FIRST_ELEMENT=2
NELEMENTS=1
MB_TX_CODE=fnct_16_write_multiple_registers

# HAL-Pins: mb2hal.optidrive_freq.00
HAL_TX_NAME=optidrive_freq

# max. 10 Hz Aktualisierung
MAX_UPDATE_RATE=10.0
DEBUG=0


# ==================== TRANSACTION 02 ====================
# Lese Ausgangsfrequenz (Reg. 7) und Motorstrom (Reg. 8)

[TRANSACTION_02]

# Gleiche serielle Verbindung

MB_SLAVE_ID=1
FIRST_ELEMENT=7
NELEMENTS=2

# Lesen von Holding-Register
MB_TX_CODE=fnct_03_read_holding_registers

# HAL-Pins:
# mb2hal.optidrive_mon.00 -> Register 7 (Frequenz Istwert, Hz x10)
# mb2hal.optidrive_mon.01 -> Register 8 (Strom Istwert, A x10)
#HAL_TX_NAME=istwert

# Update z.B. 5 Hz
MAX_UPDATE_RATE=5.0
DEBUG=0